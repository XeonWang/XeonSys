ORG 0x100

JMP BEGIN

GDT:
EMPTY_GD:
	DD 0x0
	DD 0x0
CODE_GD:
	DW 0xFFFF
	DW 0x0
	DB 0x0
	DB 10011010b
	DB 11001111b
	DB 0x0
DATA_GD:
	DW 0xFFFF
	DW 0x0
	DB 0x0
	DB 10010010b
	DB 11001111b
	DB 0x0
VEDIO_GD:
	DW 0xFFFF
	DW 0x8000
	DB 0x0B
	DB 10010010b
	DB 11001111b
	DB 0x0
GDT_END:

GDT_DESC:
	DW GDT_END - GDT - 1
	DD GDT

CODE_SEG equ CODE_GD - GDT
DATA_SEG equ DATA_GD - GDT
VEDIO_SEG equ VEDIO_GD - GDT

IDT:
%rep 256
	DW EMPTY_INT_HANDLER
	DW 0x0008
	DB 0x0
	DB 10101110b
	DW 0x0
%endrep
IDT_END:

IDT_DESC:
	DW IDT_END - IDT - 1
	DD IDT

BEGIN:
	LGDT [GDT_DESC]
	CLI
	LIDT [IDT_DESC]

	IN AL, 0x92
	OR AL, 00000010b
	OUT 0x92, AL

	MOV EAX, CR0
	OR EAX, 1
	MOV CR0, EAX

	JMP dword CODE_SEG:0xB00

EMPTY_INT_HANDLER:
	JMP $

TIMES 2560 - ($ - $$) DB 0
